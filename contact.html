<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Instamart Contact & Support</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Font Awesome for Social Icons -->
    <link rel="icon" type="image/x-icon" href="/images/favico.png">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />

  <style>
    /* ================= Global Styles ================= */
    :root {
      --primary-orange: #FC8019;
      --secondary-orange: #FFE8D5;
      --swiggy-dark: #2A2A2A;
      --swiggy-gray: #686B78;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Arial", sans-serif;
    }
    body {
      margin-top: 5vh;
      background-color: #e4e4e4;
      min-height: 130vh;
      display: flex;
      flex-direction: column;
    }

    /* ================= Navigation ================= */
    header {
      position: fixed;
      top: 0;
      width: 100%;
      padding: 5px 0;
      background: #eee;
      z-index: 9999;
      transition: all 300ms ease-in-out;
    }
    nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1200px;
      margin: auto;
      padding: 10px 20px;
    }
    .nav-left {
      display: flex;
      align-items: center;
    }
    .nav-left .logo img {
      height: 50px;
      width: auto;
    }
    .nav-center {
      flex-grow: 1;
      display: flex;
      justify-content: center;
    }
    .nav-center ul {
      list-style: none;
      display: flex;
      gap: 40px;
    }
    .nav-center ul li a {
      text-decoration: none;
      color: black;
      font-size: 1.1rem;
      font-weight: 600;
      padding: 8px 12px;
    }
    .nav-right {
      display: flex;
      align-items: center;
      gap: 20px;
    }
    .nav-right ul {
      list-style: none;
      display: flex;
      gap: 20px;
    }
    .nav-right ul li a {
      text-decoration: none;
      color: black;
      font-size: 1.1rem;
      font-weight: 600;
      padding: 8px 12px;
    }
    .nav-right .login {
      background-color: #e85915;
      color: white;
      border-radius: 5px;
      padding: 8px 12px;
    }
    .nav-center ul li a:hover,
    .nav-right ul li a:hover {
      color: #e85915;
      background-color: rgb(222, 221, 221);
      transition: 0.5s;
      border-radius: 5px;
    }
    .logo:hover img {
      transform: scale(1.05);
      transition: 1s;
    }

    /* ================= Contact Page ================= */
    .contact-container {
      max-width: 1200px;
      margin: 100px auto 50px; /* leave space for fixed header */
      padding: 30px;
      background: white;
      border-radius: 15px;
      box-shadow: 0 2px 15px rgba(0,0,0,0.1);
    }
    .contact-header {
      text-align: center;
      margin-bottom: 40px;
    }
    .contact-header h1 {
      color: #2A2A2A;
      font-size: 2.5rem;
      margin-bottom: 10px;
    }
    .contact-sections {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 30px;
    }
    .contact-card {
      padding: 25px;
      border-radius: 10px;
      background: #FFE8D5;
    }
    .contact-card h3 {
      color: #FC8019;
      margin-bottom: 15px;
    }
    .contact-form {
      margin-top: 40px;
      padding: 30px;
      background: #FFE8D5;
      border-radius: 15px;
    }
    .contact-form input,
    .contact-form textarea {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
      background: white;
    }
    .contact-form textarea {
      resize: vertical;
    }
    .submit-btn {
      background: #FC8019;
      color: white;
      padding: 15px 30px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      transition: background 0.3s;
      margin-top: 15px;
    }
    .submit-btn:hover {
      background: #FF6F00;
    }

    /* ================= Chatbot Styles ================= */
    .chatbot-toggle {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: #FC8019;
      color: white;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      z-index: 1000;
      transition: transform 0.3s;
    }
    .chatbot-toggle:hover {
      transform: scale(1.1);
    }
    .chatbot-container {
      position: fixed;
      bottom: 100px;
      right: 30px;
      width: 350px;
      height: 500px;
      background: #fff;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      transform: translateY(150%);
      transition: transform 0.3s;
      z-index: 1001;
      display: flex;
      flex-direction: column;
    }
    .chatbot-container.active {
      transform: translateY(0);
    }
    .chat-header {
      background: #FC8019;
      color: #fff;
      padding: 10px 15px;
      border-radius: 15px 15px 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .chat-title {
      font-size: 1rem;
      font-weight: bold;
    }
    .close-btn {
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      padding: 5px;
      transform: rotate(180deg);
      transition: transform 0.3s;
    }
    .close-btn.active {
      transform: rotate(0deg);
    }
    .chat-container {
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    #responseContainer {
      flex: 1;
      padding: 10px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .bot-message, .user-message {
      display: flex;
      align-items: flex-start;
      gap: 10px;
    }
    .bot-message .message-bubble {
      background: #f1f3f4;
      color: #333;
      border-bottom-left-radius: 3px;
    }
    .user-message .message-bubble {
      background: #FC8019;
      color: #fff;
      border-bottom-right-radius: 3px;
      margin-left: auto;
    }
    .message-bubble {
      max-width: 70%;
      padding: 10px;
      border-radius: 15px;
      font-size: 0.9rem;
    }
    .avatar {
      width: 35px;
      height: 35px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    /* ================= Chatbot Input, Loader & Quick Replies ================= */
    .input-section {
      display: flex !important;
      padding: 10px;
      border-top: 1px solid #eee;
      background: #fff;
    }
    #userInput {
      flex: 1;
      border: 1px solid #ddd;
      border-radius: 25px;
      padding: 10px;
      font-size: 1rem;
      transition: box-shadow 0.3s;
    }
    #userInput:focus {
      outline: none;
      box-shadow: 0 0 8px rgba(252,128,25,0.6);
    }
    .input-section button {
      background: linear-gradient(135deg, #FC8019, #FF6F00);
      border: none;
      color: white;
      padding: 10px 20px;
      border-radius: 25px;
      font-size: 1rem;
      cursor: pointer;
      margin-left: 10px;
      transition: transform 0.3s, box-shadow 0.3s;
    }
    .input-section button:hover {
      transform: scale(1.05);
      box-shadow: 0 0 8px rgba(252,128,25,0.6);
    }
    /* Loader Styling */
    .loader {
      display: none;
      margin: 10px auto;
      width: 60px;
      text-align: center;
    }
    .loader span {
      display: inline-block;
      width: 8px;
      height: 8px;
      margin: 3px;
      background-color: #FC8019;
      border-radius: 50%;
      animation: loader 1.4s infinite ease-in-out both;
    }
    .loader span:nth-child(1) {
      animation-delay: -0.32s;
    }
    .loader span:nth-child(2) {
      animation-delay: -0.16s;
    }
    @keyframes loader {
      0%, 80%, 100% {
        transform: scale(0);
      }
      40% {
        transform: scale(1);
      }
    }
    .chat-quick-replies {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }
    .chat-quick-reply {
      background: #FFE8D5;
      border: none;
      border-radius: 20px;
      padding: 8px 15px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: background 0.3s;
    }
    .chat-quick-reply:hover {
      background: #ffe0c2;
    }
    .chat-footer {
      text-align: center;
      font-size: 0.8rem;
      color: #686B78;
      border-top: 1px solid #eee;
      padding: 8px;
    }
    .agent-transfer {
      color: #d80000;
      background-color: #ffe6e6;
      border-radius: 15px;
      padding: 10px;
      margin: 10px 0;
      text-align: center;
    }
    .agent-option {
      background: #ffe0e0 !important;
      color: #d80000 !important;
      border: 1px solid #ffcccc !important;
    }
    .chatbot-backdrop {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      backdrop-filter: blur(5px);
      z-index: 999;
      display: none;
    }

    /* ================= Prompt Categories Styles ================= */
    .category-header {
      padding: 10px;
      background: #f8f8f8;
      font-weight: bold;
      border-bottom: 1px solid #eee;
    }
    .back-button {
      background: none;
      border: none;
      color: #FC8019;
      cursor: pointer;
      padding: 5px;
      font-size: 0.9rem;
    }
    .subcategory-group {
      margin-bottom: 10px;
    }
    .subcategory-title {
      font-weight: bold;
      margin: 8px 0;
      color: #2A2A2A;
    }
    .nested-prompt {
      background: #ffffff;
      border: 1px solid #FFE8D5;
      margin-left: 15px;
    }

    /* ================= Footer Styles ================= */
    footer {
      background-color: #0b0b0d;
      color: white;
      padding: 20px 0;
      text-align: center;
      margin-top: auto;
    }
    .footer-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 80%;
      margin: 0 auto;
    }
    .footer-container p {
      font-size: 16px;
    }
    .social-icons a {
      color: white;
      margin-left: 15px;
      font-size: 18px;
      text-decoration: none;
    }
    .social-icons a:hover {
      color: #ff9800;
    }
  </style>
</head>
<body>
  <!-- Navigation -->
  <header>
    <nav>
      <div class="nav-left">
        <a href="home.html" class="logo"><img src="images/logo.png" alt="Logo" /></a>
      </div>
      <div class="nav-center">
        <ul>
          <li><a href="home.html">Home</a></li>
          <li><a href="product.html">Products</a></li>
          <li><a href="help.html">Help</a></li>
          <li><a href="contact.html">Contact Us</a></li>
        </ul>
      </div>
      <div class="nav-right">
        <ul>
          <li><a href="cart.html" class="cart-icon"><i class="fa-solid fa-cart-shopping"></i></a></li>
          <li><a href="checkout.html">Checkout</a></li>
          <li><a href="login.html" class="login">Login</a></li>
        </ul>
      </div>
    </nav>
  </header>

  <!-- Main Contact Page Content -->
  <div class="contact-container" style="margin-top: 100px;">
    <div class="contact-header">
      <h1>Contact Instamart Support</h1>
      <p>We're here to help you with any questions or concerns</p>
    </div>
    <div class="contact-sections">
      <div class="contact-card">
        <h3>üìû Call Us</h3>
        <p>24/7 Customer Support</p>
        <p>+91 12345 67890</p>
      </div>
      <div class="contact-card">
        <h3>üìß Email Us</h3>
        <p>General Inquiries</p>
        <p>support@instamart.com</p>
      </div>
      <div class="contact-card">
        <h3>üìç Headquarters</h3>
        <p>Instamart House, Bangalore</p>
        <p>Karnataka, India</p>
      </div>
    </div>
    <div class="contact-form">
      <h2>Send us a Message</h2>
      <form>
        <input type="text" placeholder="Your Name" required>
        <input type="email" placeholder="Your Email" required>
        <textarea rows="5" placeholder="Your Message" required></textarea>
        <button type="submit" class="submit-btn">Send Message</button>
      </form>
    </div>
  </div>

  <!-- Chatbot Toggle -->
  <div class="chatbot-toggle" onclick="toggleChatbot()">üí¨</div>
  <div class="chatbot-backdrop" id="backdrop"></div>

  <!-- Chatbot Container -->
  <div class="chatbot-container">
    <div class="chat-header">
      <div class="chat-title">Instamart Support</div>
      <button class="close-btn" onclick="toggleChatbot()">‚¨áÔ∏è</button>
    </div>
    <div class="chat-container">
      <div id="responseContainer"></div>
      <!-- Loader -->
      <div id="loader" class="loader">
        <span></span>
        <span></span>
        <span></span>
      </div>
      <div class="input-section">
        <input type="text" id="userInput" placeholder="Type your message...">
        <button onclick="handleUserInput()">Send</button>
      </div>
    </div>
    <div class="chat-footer">
      We run on <strong>Instamart Assistant</strong>
    </div>
  </div>

  <!-- Footer -->
  <footer>
    <div class="footer-container">
      <p>¬© 2025 Instamart</p>
      <div class="social-icons">
        <a href="https://www.facebook.com/Instamart/"><i class="fab fa-facebook-f"></i></a>
        <a href="https://in.pinterest.com/instamart/"><i class="fab fa-pinterest"></i></a>
        <a href="https://www.instagram.com/instamart/"><i class="fab fa-instagram"></i></a>
        <a href="https://x.com/Instamart"><i class="fab fa-twitter"></i></a>
      </div>
    </div>
  </footer>

  <!-- Chatbot Script -->
  <script>
    // ======== 1. Chat Toggle & Backdrop ========
    function toggleChatbot() {
      const chatbot = document.querySelector('.chatbot-container');
      const backdrop = document.getElementById('backdrop');
      const closeBtn = document.querySelector('.close-btn');
      chatbot.classList.toggle('active');
      closeBtn.classList.toggle('active');
      backdrop.style.display = chatbot.classList.contains('active') ? 'block' : 'none';
    }
    document.getElementById('backdrop').addEventListener('click', toggleChatbot);

    // ======== 2. Generative Language API Details ========

    // ======== 3. Agent Chat & Refund State Management ========
    let isAwaitingRefundDescription = false;
    let currentSupportCaseType = '';

    // ======== 4. Predefined Replies for Each Predefined Prompt ========
    const predefinedReplies = {
      "How do I subscribe?": "To subscribe, simply click the subscribe button on our website and follow the on-screen instructions.",
      "Cancel subscription": "To cancel your subscription, please log in to your account and navigate to the subscription settings.",
      "Upgrade subscription": "For upgrading your subscription, please visit our plans page or contact our support team for more options.",
      "Payment methods": "We accept credit/debit cards, net banking, and various mobile wallets for your convenience.",
      "Refund request": "Tell your order number and describe what happened with your order:",
      "Billing issues": "For billing issues, please provide your order details so we can help resolve the matter.",
      "Change email": "To change your email, please update your profile settings in your account.",
      "Reset password": "To reset your password, click on 'Forgot Password' on the login page and follow the instructions.",
      "Update profile info": "To update your profile information, go to your account settings and edit your details accordingly."
    };

    // ======== 5. Category & Prompt Structure (One-Bubble Approach) ========
    const promptCategories = [
      {
        title: "Subscription",
        mainPrompts: ["How do I subscribe?", "Cancel subscription", "Upgrade subscription"]
      },
      {
        title: "Payments",
        mainPrompts: ["Payment methods", "Refund request", "Billing issues"]
      },
      {
        title: "Account management",
        mainPrompts: ["Change email", "Reset password", "Update profile info"]
      }
    ];

    // ======== 6. On DOM Load: Show Categories in Single Bot Message ========
    document.addEventListener("DOMContentLoaded", () => {
      showMainCategoriesInChat();
    });

    // ======== 7. Show Categories in Single Bot Message ========
    function showMainCategoriesInChat() {
      const container = document.getElementById("responseContainer");
      const botDiv = document.createElement("div");
      botDiv.className = "bot-message";
      botDiv.innerHTML = `<img src="images/cust.jpg" class="avatar" alt="Instamart Executive">`;
      const bubble = document.createElement("div");
      bubble.className = "message-bubble";
      bubble.innerHTML = `
        <p>Hi there! Thanks for getting in touch.<br>
        Choose from these topics what brings you here, and I'll try my best to assist you üòä</p>
      `;
      const quickReplies = document.createElement("div");
      quickReplies.className = "chat-quick-replies";
      promptCategories.forEach(category => {
        const btn = document.createElement("button");
        btn.className = "chat-quick-reply";
        btn.textContent = category.title;
        btn.onclick = () => handleCategorySelect(category);
        quickReplies.appendChild(btn);
      });
      bubble.appendChild(quickReplies);
      botDiv.appendChild(bubble);
      container.appendChild(botDiv);
      container.scrollTop = container.scrollHeight;
    }

    // ======== 8. Handle Category Selection ========
    function handleCategorySelect(category) {
      appendUserMessage(category.title);
      const container = document.getElementById("responseContainer");
      const botDiv = document.createElement("div");
      botDiv.className = "bot-message";
      botDiv.innerHTML = `<img src="images/cust.jpg" class="avatar" alt="Instamart Executive">`;
      const bubble = document.createElement("div");
      bubble.className = "message-bubble";
      bubble.innerHTML = `<p>You selected <strong>${category.title}</strong>. Please pick an option:</p>`;
      const quickReplies = document.createElement("div");
      quickReplies.className = "chat-quick-replies";
      category.mainPrompts.forEach(item => {
        const btn = document.createElement("button");
        btn.className = "chat-quick-reply";
        btn.textContent = item;
        btn.onclick = () => handleMainPrompt(item);
        quickReplies.appendChild(btn);
      });
      bubble.appendChild(quickReplies);
      botDiv.appendChild(bubble);
      container.appendChild(botDiv);
      container.scrollTop = container.scrollHeight;
    }

    // ======== 9. Handle a Main Prompt with Predefined Reply ========
    function handleMainPrompt(item) {
      appendUserMessage(item);
      if (predefinedReplies[item]) {
        const container = document.getElementById("responseContainer");
        const botDiv = document.createElement("div");
        botDiv.className = "bot-message";
        botDiv.innerHTML = `<img src="images/cust.jpg" class="avatar" alt="Instamart Executive">`;
        const bubble = document.createElement("div");
        bubble.className = "message-bubble";
        bubble.innerHTML = `<p>${predefinedReplies[item]}</p>`;
        botDiv.appendChild(bubble);
        container.appendChild(botDiv);
        container.scrollTop = container.scrollHeight;
        if (item.toLowerCase().includes("refund")) {
          isAwaitingRefundDescription = true;
          currentSupportCaseType = 'refund';
        }
      } else {
        getGeminiResponse(item);
      }
    }

    // ======== 10. Append User Message ========
    function appendUserMessage(text) {
      const container = document.getElementById("responseContainer");
      const userDiv = document.createElement("div");
      userDiv.className = "user-message";
      userDiv.innerHTML = `<div class="message-bubble">${text}</div>`;
      container.appendChild(userDiv);
      container.scrollTop = container.scrollHeight;
    }

    // ======== 11. Handle User Input from Text Field ========
    function handleUserInput() {
      const userInput = document.getElementById("userInput");
      if (!userInput.value) return;
      const typedText = userInput.value;
      appendUserMessage(typedText);
      userInput.value = "";
      getGeminiResponse(typedText);
    }
    
    // Trigger send on Enter key (without Shift)
    document.getElementById("userInput").addEventListener("keydown", function(e) {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        handleUserInput();
      }
    });

    // ======== 12. getGeminiResponse (Generative + Agent Logic) ========
    async function getGeminiResponse(userText) {
      const container = document.getElementById('responseContainer');
      let generatedText;
      
      // Show loader while waiting for API response
      document.getElementById('loader').style.display = 'block';
      
      if (isAwaitingRefundDescription) {
        generatedText = `‚úÖ Your ${currentSupportCaseType} request (#${Math.floor(100000 + Math.random() * 900000)}) has been escalated!
          <div class="agent-transfer">
            Our ${currentSupportCaseType} specialist will contact you within 15 minutes.
          </div>`;
        isAwaitingRefundDescription = false;
        console.log("New", currentSupportCaseType, "case:", userText);
      } else {
        try {
          // Prepend system instruction to the user input
          const fullText = "You are an Instamart support assistant. Only provide answers related to Instamart products, services, orders, refunds, and customer support. Do not provide any information outside of this scope. Also, do not give the answer to the user in more than 70-80 words. " + userText;
          const response = await fetch(`${API_URL}?key=${API_KEY}`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
              contents: [{
                role: "user",
                parts: [{ text: fullText }]
              }]
            })
          });
          const data = await response.json();
          if (!data.candidates || !data.candidates[0] || !data.candidates[0].content?.parts[0].text) {
            throw new Error("Invalid response from Gemini API");
          }
          generatedText = data.candidates[0].content.parts[0].text;
          // Remove unwanted markdown symbols like * and _
          generatedText = generatedText.replace(/[*_]/g, '');
        } catch (error) {
          generatedText = `Error: ${error.message}`;
        }
      }
      
      // Hide loader after API call
      document.getElementById('loader').style.display = 'none';
      
      const botDiv = document.createElement('div');
      botDiv.className = 'bot-message';
      botDiv.innerHTML = `
        <img src="images/cust.jpg" class="avatar" alt="Instamart Executive">
        <div class="message-bubble">${generatedText}</div>
      `;
      container.appendChild(botDiv);
      container.scrollTop = container.scrollHeight;
    }

    // ======== 13. Modified showSubcategories Function ========
    function showSubcategories(prompt) {
      const quickReplies = document.getElementById('quickReplies');
      quickReplies.innerHTML = `
        <div class="category-header">
          <button class="back-button" onclick="showCategoryPrompts(currentCategory)">‚Üê Back</button>
          ${prompt.text}
        </div>
      `;
      const subGroup = document.createElement('div');
      subGroup.className = 'subcategory-group';
      prompt.subcategories.forEach(sub => {
        const subButton = document.createElement('button');
        subButton.className = 'quick-reply nested-prompt';
        subButton.textContent = sub;
        subButton.onclick = () => insertQuestion(sub);
        subGroup.appendChild(subButton);
      });
      const agentButton = document.createElement('button');
      agentButton.className = 'quick-reply nested-prompt agent-option';
      agentButton.textContent = 'üí¨ Chat with Agent';
      agentButton.onclick = () => startAgentChat(currentCategory.title);
      subGroup.appendChild(agentButton);
      quickReplies.appendChild(subGroup);
    }

    // ======== 14. New Function to Handle Agent Chat Initiation ========
    function startAgentChat(category) {
      const responseContainer = document.getElementById('responseContainer');
      isAwaitingRefundDescription = true;
      currentSupportCaseType = category.toLowerCase().replace(/[^a-z]/g, '');
      document.querySelector('.input-section').style.display = 'flex';
      const botDiv = document.createElement('div');
      botDiv.className = 'bot-message';
      botDiv.innerHTML = `
        <img src="images/cust.jpg" class="avatar" alt="Instamart Executive">
        <div class="message-bubble">
          <div class="agent-transfer">
            Please tell your order number and describe what happened with your order:
          </div>
        </div>
      `;
      responseContainer.appendChild(botDiv);
      responseContainer.scrollTop = responseContainer.scrollHeight;
    }

    // ======== 15. Modified insertQuestion Function ========
    function insertQuestion(question) {
      const inputField = document.getElementById('userInput');
      inputField.value = question;
      inputField.focus();
      getGeminiResponse();
    }
  </script>
  <!-- End of New Script Section -->
</body>
</html>
